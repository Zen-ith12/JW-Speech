<!DOCTYPE html>

<html lang="es">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JW Speech</title>
<style>
  body {
    background-color: #121212;
    color: #f0f0f0;
    font-family: 'Segoe UI', sans-serif;
    padding: 1rem;
    max-width: 800px;
    margin: auto;
  }
  input, textarea, select, button {
    width: 100%;
    margin: 0.5rem 0;
    padding: 0.5rem;
    font-size: 1rem;
    border: none;
    border-radius: 4px;
  }
  textarea {
    height: 250px;
  }
  button {
    background-color: #1e88e5;
    color: white;
    cursor: pointer;
  }
  .discurso {
    background-color: #1e1e1e;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 8px;
  }
  .delete-btn {
    background-color: crimson;
  }
</style>


<body>
<h1>JW Speech</h1>

<input id="search" type="text" placeholder="Buscar discursos..." oninput="mostrarDiscursos()" />

<h2>Nuevo discurso</h2>
<input id="titulo" type="text" placeholder="Título del discurso" />

<select id="categoria">
  <option value="Publico">Discursos Público</option>
  <option value="Tesoros">Tesoros de la Biblia</option>
  <option value="Congregacion">Necesidades de la Congregación</option>
  <option value="Asamblea">Asamblea</option>
  <option value="FuneralMatrimonio">Funeral / Matrimonio</option>
</select>

<textarea id="contenido" placeholder="Contenido del discurso..."></textarea>

<input type="hidden" id="discurso-id" />

<button onclick="guardarDiscurso()">Guardar discurso</button>
<button onclick="arreglarDiscursos()">Arreglar discursos antiguos</button>
<button onclick="exportarDiscursos()">Exportar discursos</button>
<input type="file" accept="application/json" onchange="importarDiscursos(event)" />

<h2>Discursos guardados</h2>
<div id="lista"></div>

<script>
  function uuidv4() {
    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
    );
  } 

    const id = document.getElementById('discurso-id').value;
    const titulo = document.getElementById('titulo').value.trim();
    const categoria = document.getElementById('categoria').value;
    const contenido = document.getElementById('contenido').value.trim();
    if (!titulo || !contenido) return alert('Completa título y contenido');
    let discursos = JSON.parse(localStorage.getItem('discursos') || '[]');

    if (id) {
      discursos = discursos.map(d => d.id === id ? { id, titulo, categoria, contenido } : d);
    } else {
      discursos.push({ id: uuidv4(), titulo, categoria, contenido });
    }

    localStorage.setItem('discursos', JSON.stringify(discursos));
    document.getElementById('discurso-id').value = '';
    document.getElementById('titulo').value = '';
    document.getElementById('contenido').value = '';
    document.getElementById('form-title').innerText = 'Nuevo discurso';
    mostrarDiscursos();
  }

    let discursos = JSON.parse(localStorage.getItem('discursos') || '[]');
    discursos = discursos.filter(d => d.id && d.id !== id);
    localStorage.setItem('discursos', JSON.stringify(discursos));
    mostrarDiscursos();
  }

  function editarDiscurso(id) {
    const discursos = JSON.parse(localStorage.getItem('discursos') || '[]');
    const discurso = discursos.find(d => d.id === id);
    if (discurso) {
      document.getElementById('discurso-id').value = discurso.id;
      document.getElementById('titulo').value = discurso.titulo;
      document.getElementById('categoria').value = discurso.categoria;
      document.getElementById('contenido').value = discurso.contenido;
      document.getElementById('form-title').innerText = 'Editar discurso';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

    const lista = document.getElementById('lista');
    const filtro = document.getElementById('search').value.toLowerCase();
    const discursos = JSON.parse(localStorage.getItem('discursos') || '[]');
    lista.innerHTML = '';
    discursos.filter(d =>
      d.titulo?.toLowerCase().includes(filtro) ||
      d.contenido?.toLowerCase().includes(filtro)
    ).forEach(d => {
      const div = document.createElement('div');
      div.className = 'discurso';
      div.innerHTML = `
        <strong>${d.titulo || 'Sin título'}</strong><br>
        <em>${d.categoria || 'Sin categoría'}</em><br>
        <p>${d.contenido || ''}</p>
        <button class="edit-btn" onclick="editarDiscurso('${d.id}')">Editar</button>
        <button class="delete-btn" onclick="eliminarDiscurso('${d.id}')">Eliminar</button>
      `;
      lista.appendChild(div);
    });
  }
  
    let discursos = JSON.parse(localStorage.getItem('discursos') || '[]');
    let actualizados = discursos.map(d => {
      return {
        id: d.id && d.id.length > 0 ? d.id : uuidv4(),
        titulo: d.titulo || 'Sin título',
        categoria: d.categoria || 'General',
        contenido: d.contenido || ''
      };
    });
    localStorage.setItem('discursos', JSON.stringify(actualizados));
    alert('Discursos antiguos actualizados correctamente.');
    mostrarDiscursos();
  }

  function exportarDiscursos() {
    const discursos = localStorage.getItem('discursos');
    const blob = new Blob([discursos], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'discursos_backup.json';
    a.click();
    URL.revokeObjectURL(url);
   }

    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const nuevos = JSON.parse(e.target.result);
        if (!Array.isArray(nuevos)) throw new Error('Formato incorrecto');
        localStorage.setItem('discursos', JSON.stringify(nuevos));
        alert('Discursos importados correctamente.');
        mostrarDiscursos();
      } catch (error) {
        alert('Error al importar el archivo. Asegúrate de que sea un .json válido.');
      }
    };
    reader.readAsText(file);
  }

  mostrarDiscursos();
</script>
</body>
</html>
